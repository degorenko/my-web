#{extends 'main.html' /}
#{set title:'Home' /}
<div id="container" xmlns="http://www.w3.org/1999/html">
    <div id="header">
        <h1>mini<strong>DEMO</strong></h1>
        <h2>Show example statistic for my project</h2>
    </div>
    <div id="sidebar">
        <h1>Mini FAQ</h1>
        <p> Choose db, collection and fields</p>
        <p> When you choose some field, also you can specify additional parameter
            from others fields.
        </p>
    </div>
    <div id="content">
        <h1>Graphs</h1>
        <form method="post" action="/chart">
            <p> This is where you can choose dataBase, collections, fields and categories.</p>
            <h2>Databases:
            <select name="dbs" id="dbs">
                #{list items: dbs, as:'i'}<option value="${i}">${i}</option>#{/list}
            </select></h2>
            <h2>Collections:
            <select name="collections" id="collections"></select></h2>
            <h2>Fields:
            <select name="fields" id="fields"></select></h2>
            <input type="checkbox" id="checkbox1">label1</input>
            <input type="checkbox" id="checkbox2">label2</input>
            <h2><input type="submit" value="Create chart"></h2>
        </form>
    </div>
</div>
<script type="text/javascript">
    $(function() {
        $.ajaxSetup({async: false});
        $("#dbs").change(function() {
            var value = $(this).val();

            $.get("/collections", {"dbname": value}, function(data) {
                $("#collections").find("option").remove();
                $(data).each(function(index, element) {
                    var htmlTemplate = "<option value='" + element +"'>" + element + "</option>";
                    $("#collections").append(htmlTemplate);
                })
            });
        })

        $("#collections").change(function() {
            var db = $("#dbs").val();
            var col = $(this).val();
            $.get("/fields", {"dbname": db, "collectionname": col}, function(data) {
                $("#fields").find("option").remove();
                $(data).each(function(index,element) {
                    var htmlTemplate2 = "<option value='" + element +"'>" + element + " </option>";
                    $("#fields").append(htmlTemplate2);
                })

            });
        })
        $("#dbs").change();
        $("#collections").change();
    })

</script>